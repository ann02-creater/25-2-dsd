<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>RISC-V Pipeline Processor - 기말과제 보고서</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 11pt;
            line-height: 1.8;
            max-width: 210mm;
            margin: 0 auto;
            padding: 20mm;
        }

        h1 {
            font-size: 18pt;
            margin: 30px 0 20px;
            border-bottom: 2px solid #000;
            padding-bottom: 10px;
        }

        h2 {
            font-size: 14pt;
            margin: 25px 0 15px;
        }

        h3 {
            font-size: 12pt;
            margin: 20px 0 10px;
        }

        p {
            margin: 10px 0;
            text-align: justify;
            text-indent: 1em;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 10pt;
        }

        th,
        td {
            border: 1px solid #000;
            padding: 8px;
            text-align: center;
        }

        th {
            background: #f0f0f0;
        }

        .caption {
            text-align: center;
            font-size: 10pt;
            margin: 10px 0;
            font-weight: bold;
        }

        .cover {
            text-align: center;
            padding: 60px 0;
            min-height: 100vh;
        }

        .cover .title {
            font-size: 22pt;
            font-weight: bold;
            margin: 30px 0;
        }

        .cover .subtitle {
            font-size: 14pt;
            margin: 10px 0;
            color: #333;
        }

        .diagram {
            background: #f5f5f5;
            border: 1px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        ul,
        ol {
            margin: 15px 0 15px 30px;
        }

        li {
            margin: 8px 0;
        }

        .page-num {
            text-align: center;
            font-size: 10pt;
            margin: 30px 0;
            color: #666;
        }

        .toc-table {
            border: none;
        }

        .toc-table tr,
        .toc-table td {
            border: none;
        }

        .student-info {
            margin: 20px auto;
            border: 1px solid #000;
            padding: 20px;
            display: inline-block;
        }

        pre {
            background: #f5f5f5;
            padding: 15px;
            font-size: 9pt;
            line-height: 1.4;
            overflow-x: auto;
            border: 1px solid #ddd;
        }

        @media print {
            .page-break {
                page-break-before: always;
            }
        }
    </style>
</head>

<body>

    <!-- ========== 1. 표지 ========== -->
    <div class="cover">
        <p style="font-size: 16pt; font-weight: bold; margin-top: 50px;">2024-02 디지털 시스템 설계</p>
        <p class="title">기말과제 보고서</p>
        <br>
        <p style="font-size: 18pt; font-weight: bold;">RISC-V 5-Stage Pipeline Processor</p>
        <p style="font-size: 14pt; color: #555;">PS2 키보드 + VGA 기반 홀짝 게임</p>
        <br><br><br>

        <div class="student-info">
            <table style="border: none; width: auto; margin: 0;">
                <tr style="border: none;">
                    <td style="border: none; text-align: left; padding: 5px 20px;">과목명</td>
                    <td style="border: none; text-align: left; padding: 5px 20px;">디지털 시스템 설계</td>
                </tr>
                <tr style="border: none;">
                    <td style="border: none; text-align: left; padding: 5px 20px;">지도교수</td>
                    <td style="border: none; text-align: left; padding: 5px 20px;">이 강 교수님</td>
                </tr>
                <tr style="border: none;">
                    <td style="border: none; text-align: left; padding: 5px 20px;">제출일</td>
                    <td style="border: none; text-align: left; padding: 5px 20px;">2024년 12월 12일</td>
                </tr>
                <tr style="border: none;">
                    <td style="border: none; text-align: left; padding: 5px 20px;">소속</td>
                    <td style="border: none; text-align: left; padding: 5px 20px;">한동대학교 전산전자공학부</td>
                </tr>
                <tr style="border: none;">
                    <td style="border: none; text-align: left; padding: 5px 20px;">학번</td>
                    <td style="border: none; text-align: left; padding: 5px 20px;">22400387</td>
                </tr>
                <tr style="border: none;">
                    <td style="border: none; text-align: left; padding: 5px 20px;">이름</td>
                    <td style="border: none; text-align: left; padding: 5px 20px;">송해원</td>
                </tr>
            </table>
        </div>
    </div>

    <div class="page-break"></div>
    <div class="page-num">- 2 -</div>

    <!-- ========== 2. 목차 ========== -->
    <h1 style="text-align: center; border: none;">목 차</h1>

    <table class="toc-table">
        <tr>
            <td style="text-align: left; font-weight: bold;">1. 문제정의</td>
            <td style="text-align: right; width: 50px;">3</td>
        </tr>
        <tr>
            <td style="text-align: left; padding-left: 20px;">1.1 목적</td>
            <td style="text-align: right;">3</td>
        </tr>
        <tr>
            <td style="text-align: left; padding-left: 20px;">1.2 기능</td>
            <td style="text-align: right;">4</td>
        </tr>
        <tr>
            <td style="text-align: left; padding-left: 20px;">1.3 입출력</td>
            <td style="text-align: right;">6</td>
        </tr>
        <tr>
            <td style="text-align: left; font-weight: bold;">2. 설계</td>
            <td style="text-align: right;">별도 파일</td>
        </tr>
        <tr>
            <td style="text-align: left; padding-left: 20px;">2.1 Top-Module</td>
            <td style="text-align: right;"></td>
        </tr>
        <tr>
            <td style="text-align: left; padding-left: 20px;">2.2 Algorithm (Pipeline)</td>
            <td style="text-align: right;"></td>
        </tr>
        <tr>
            <td style="text-align: left; padding-left: 20px;">2.3 Datapath</td>
            <td style="text-align: right;"></td>
        </tr>
        <tr>
            <td style="text-align: left; padding-left: 20px;">2.4 Controller</td>
            <td style="text-align: right;"></td>
        </tr>
        <tr>
            <td style="text-align: left; font-weight: bold;">3. 코딩</td>
            <td style="text-align: right;">별도 파일</td>
        </tr>
        <tr>
            <td style="text-align: left; padding-left: 20px;">3.1 모듈 계층도</td>
            <td style="text-align: right;"></td>
        </tr>
        <tr>
            <td style="text-align: left; padding-left: 20px;">3.2 오픈소스/AI 사용 여부</td>
            <td style="text-align: right;"></td>
        </tr>
        <tr>
            <td style="text-align: left; font-weight: bold;">4. 시뮬레이션</td>
            <td style="text-align: right;">별도 파일</td>
        </tr>
        <tr>
            <td style="text-align: left; font-weight: bold;">5. 구현</td>
            <td style="text-align: right;">별도 파일</td>
        </tr>
        <tr>
            <td style="text-align: left; font-weight: bold;">6. 부록</td>
            <td style="text-align: right;">별도 파일</td>
        </tr>
    </table>

    <div class="page-break"></div>
    <div class="page-num">- 3 -</div>

    <!-- ========== 3. 문제정의 ========== -->
    <h1>1. 문제정의</h1>

    <h2>1.1 목적</h2>

    <p>
        본 프로젝트는 RISC 아키텍처 중 하나인 <strong>RISC-V Architecture</strong>를 설계하는 것을 목표로 한다.
        특히 5단계 Pipeline Processor를 설계하여 보다 효율적으로 명령을 처리할 수 있도록 하였다.
        RISC-V는 UC Berkeley에서 개발한 오픈소스 ISA(Instruction Set Architecture)로, 학계와 산업계에서 빠르게 채택되고 있다.
    </p>

    <p>
        RISC-V Instruction Set Architecture(RV32I)를 수행하기 위한 Datapath와 Controller를 설계하고,
        이를 Verilog HDL로 기술하여 FPGA 보드 위에서 동작하는 실제 프로세서를 구현한다.
    </p>

    <p>
        <strong>최종 목표는 "홀수/짝수 맞추기 게임"을 FPGA 보드에서 동작시키는 것이다.</strong>
    </p>

    <ul>
        <li><strong>입력:</strong> PS2 키보드로 숫자 입력 (0-9, Enter, Backspace)</li>
        <li><strong>처리:</strong> RISC-V CPU가 홀짝 판별 수행</li>
        <li><strong>출력:</strong> VGA 모니터에 "ODD" 또는 "EVEN" 표시, LED 점멸</li>
    </ul>

    <h3>1.1.1 프로젝트 구성</h3>

    <table>
        <tr>
            <th>구성 요소</th>
            <th>설명</th>
            <th>비고</th>
        </tr>
        <tr>
            <td>CPU Core</td>
            <td>5-Stage RISC-V RV32I Pipeline Processor</td>
            <td>darkriscv 참조</td>
        </tr>
        <tr>
            <td>입력 장치</td>
            <td>PS2 키보드 (숫자 0-9, Enter, Backspace)</td>
            <td>직접 구현</td>
        </tr>
        <tr>
            <td>출력 장치</td>
            <td>VGA 모니터 (640×480, ODD/EVEN 표시)</td>
            <td>직접 구현</td>
        </tr>
        <tr>
            <td>보조 출력</td>
            <td>7-Segment (입력 숫자), LED (결과)</td>
            <td>직접 구현</td>
        </tr>
        <tr>
            <td>게임 로직</td>
            <td>C 언어 → RISC-V 컴파일 → BRAM</td>
            <td>직접 구현</td>
        </tr>
    </table>
    <p class="caption">[표 1-1] 프로젝트 구성 요소</p>

    <div class="page-break"></div>
    <div class="page-num">- 4 -</div>

    <h2>1.2 기능</h2>

    <h3>1.2.1 프로세서 기능</h3>

    <p>
        본 프로세서는 RISC-V RV32I 명령어 세트를 지원하며, 5단계 파이프라인(IF-ID-EX-MEM-WB)으로 동작한다.
    </p>

    <table>
        <tr>
            <th>Category</th>
            <th>Format</th>
            <th>Instruction</th>
            <th>동작</th>
        </tr>
        <tr>
            <td rowspan="3">Arithmetic</td>
            <td>R</td>
            <td>ADD, SUB</td>
            <td>rd = rs1 ± rs2</td>
        </tr>
        <tr>
            <td>I</td>
            <td>ADDI</td>
            <td>rd = rs1 + imm</td>
        </tr>
        <tr>
            <td>R</td>
            <td>SLT, SLTU</td>
            <td>rd = (rs1 < rs2)</td>
        </tr>
        <tr>
            <td rowspan="2">Logical</td>
            <td>R</td>
            <td>AND, OR, XOR</td>
            <td>비트 논리 연산</td>
        </tr>
        <tr>
            <td>I</td>
            <td>ANDI, ORI, XORI</td>
            <td>즉시값 논리 연산</td>
        </tr>
        <tr>
            <td rowspan="2">Shift</td>
            <td>R</td>
            <td>SLL, SRL, SRA</td>
            <td>시프트 연산</td>
        </tr>
        <tr>
            <td>I</td>
            <td>SLLI, SRLI, SRAI</td>
            <td>즉시값 시프트</td>
        </tr>
        <tr>
            <td rowspan="2">Memory</td>
            <td>I</td>
            <td>LW, LB, LBU</td>
            <td>메모리 로드</td>
        </tr>
        <tr>
            <td>S</td>
            <td>SW, SB</td>
            <td>메모리 스토어</td>
        </tr>
        <tr>
            <td>Branch</td>
            <td>B</td>
            <td>BEQ, BNE, BLT, BGE</td>
            <td>조건 분기</td>
        </tr>
        <tr>
            <td>Jump</td>
            <td>J/I</td>
            <td>JAL, JALR</td>
            <td>점프 및 링크</td>
        </tr>
        <tr>
            <td>Upper Imm</td>
            <td>U</td>
            <td>LUI, AUIPC</td>
            <td>상위 즉시값</td>
        </tr>
    </table>
    <p class="caption">[표 1-2] 지원 RISC-V 명령어</p>

    <div class="page-break"></div>
    <div class="page-num">- 5 -</div>

    <h3>1.2.2 게임 기능 (홀짝 게임)</h3>

    <p>
        사용자가 PS2 키보드로 숫자를 입력하면, CPU가 홀짝을 판별하여 VGA 화면에 결과를 표시한다.
    </p>

    <div class="diagram">
        <pre style="font-size: 10pt; text-align: left; display: inline-block;">
┌─────────────────────────────────────────────────────────────────┐
│                    홀짝 게임 동작 흐름도                         │
└─────────────────────────────────────────────────────────────────┘

  [PS2 키보드]          [RISC-V CPU]            [출력 장치]
       │                     │                      │
       │  숫자 키 입력       │                      │
       │  (0-9)              │                      │
       ├────────────────────>│                      │
       │                     │  7-Segment 업데이트  │
       │                     ├─────────────────────>│ 입력 숫자 표시
       │                     │                      │
       │  Enter 키 입력      │                      │
       ├────────────────────>│                      │
       │                     │                      │
       │                     │  num % 2 계산        │
       │                     │                      │
       │                     │  VGA 결과 출력       │
       │                     ├─────────────────────>│ "ODD" or "EVEN"
       │                     │                      │
       │                     │  LED 제어            │
       │                     ├─────────────────────>│ ON/OFF
       │                     │                      │
       │  Backspace 입력     │                      │
       ├────────────────────>│                      │
       │                     │  마지막 자리 삭제    │
       │                     ├─────────────────────>│ 업데이트
       │                     │                      │
</pre>
    </div>
    <p class="caption">[그림 1-1] 홀짝 게임 동작 흐름도</p>

    <h3>1.2.3 게임 소스코드 (main.c)</h3>

    <pre>
/* main.c - 홀짝 게임 */
typedef unsigned int uint32_t;

#define NUM_INPUT  (*(volatile uint32_t *)0x50000000)  // 입력된 숫자
#define NUM_VALID  (*(volatile uint32_t *)0x50000004)  // 입력 완료 플래그
#define VGA_RESULT (*(volatile uint32_t *)0x40000000)  // VGA 결과 출력
#define LED_ADDR   (*(volatile uint32_t *)0x20000000)  // LED 제어

int main() {
    uint32_t num;
    while (1) {
        while (!(NUM_VALID & 0x1));  // Enter 키 대기
        num = NUM_INPUT;             // 숫자 읽기
        
        if (num % 2 == 0) {
            VGA_RESULT = 2;          // EVEN 표시
            LED_ADDR = 0x0000;       // LED OFF
        } else {
            VGA_RESULT = 1;          // ODD 표시
            LED_ADDR = 0xFFFF;       // LED ON
        }
    }
    return 0;
}
</pre>
    <p class="caption">[코드 1-1] main.c - 홀짝 게임 소스코드</p>

    <div class="page-break"></div>
    <div class="page-num">- 6 -</div>

    <h2>1.3 입출력</h2>

    <h3>1.3.1 입출력 개요</h3>

    <table>
        <tr>
            <th>구분</th>
            <th>장치</th>
            <th>핀</th>
            <th>기능</th>
        </tr>
        <tr>
            <td rowspan="3">입력</td>
            <td>PS2 Keyboard</td>
            <td>F4 (CLK), B2 (DATA)</td>
            <td>숫자 입력 (0-9, Enter, BS)</td>
        </tr>
        <tr>
            <td>Reset Button</td>
            <td>C12</td>
            <td>시스템 리셋 (Active-Low)</td>
        </tr>
        <tr>
            <td>Switch[0]</td>
            <td>J15</td>
            <td>디버그 모드 선택</td>
        </tr>
        <tr>
            <td rowspan="4">출력</td>
            <td>VGA Display</td>
            <td>A3~D8, B11, B12</td>
            <td>ODD/EVEN 결과 표시</td>
        </tr>
        <tr>
            <td>7-Segment</td>
            <td>T10~L18, J17~U13</td>
            <td>입력 숫자 표시 (8자리)</td>
        </tr>
        <tr>
            <td>LED[0]</td>
            <td>H17</td>
            <td>Heartbeat (0.75Hz)</td>
        </tr>
        <tr>
            <td>LED[15:1]</td>
            <td>K15~R12</td>
            <td>홀짝 결과 (홀수=ON)</td>
        </tr>
    </table>
    <p class="caption">[표 1-3] 입출력 핀 할당</p>

    <h3>1.3.2 Memory-Mapped I/O 주소</h3>

    <table>
        <tr>
            <th>주소</th>
            <th>장치</th>
            <th>R/W</th>
            <th>설명</th>
        </tr>
        <tr>
            <td>0x00000000 ~ 0x0FFFFFFF</td>
            <td>BRAM</td>
            <td>R/W</td>
            <td>Instruction & Data Memory</td>
        </tr>
        <tr>
            <td>0x20000000</td>
            <td>LED</td>
            <td>W</td>
            <td>LED[15:0] 제어</td>
        </tr>
        <tr>
            <td>0x30000000</td>
            <td>PS2 Scancode</td>
            <td>R</td>
            <td>키보드 스캔코드</td>
        </tr>
        <tr>
            <td>0x30000004</td>
            <td>PS2 Key Pressed</td>
            <td>R</td>
            <td>키 눌림 플래그</td>
        </tr>
        <tr>
            <td>0x40000000</td>
            <td>VGA Result</td>
            <td>W</td>
            <td>0=clear, 1=ODD, 2=EVEN</td>
        </tr>
        <tr>
            <td>0x50000000</td>
            <td>Number Buffer</td>
            <td>R</td>
            <td>입력된 숫자 값 (32-bit)</td>
        </tr>
        <tr>
            <td>0x50000004</td>
            <td>Number Valid</td>
            <td>R</td>
            <td>Enter 눌림 플래그</td>
        </tr>
    </table>
    <p class="caption">[표 1-4] Memory Map</p>

    <div class="page-break"></div>
    <div class="page-num">- 7 -</div>

    <h3>1.3.3 시스템 블록도</h3>

    <div class="diagram">
        <pre style="font-size: 9pt; text-align: left; display: inline-block;">
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              Nexys A7 FPGA Board                                 │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ┌────────────────┐                    ┌──────────────────────┐                 │
│  │   PS2 Keyboard │                    │     top.v            │                 │
│  │    (F4, B2)    │───scancode────────>│                      │                 │
│  └────────────────┘   key_pressed      │  ┌────────────────┐  │                 │
│                                        │  │  data_path.v   │  │                 │
│  ┌────────────────┐                    │  │  (CPU Core)    │  │                 │
│  │  100MHz Clock  │───clk─────────────>│  │                │  │                 │
│  │     (E3)       │                    │  │  - Pipeline    │  │                 │
│  └────────────────┘                    │  │  - BRAM        │  │                 │
│                                        │  │  - MMIO        │  │                 │
│  ┌────────────────┐                    │  └───────┬────────┘  │                 │
│  │  Reset Button  │───rst─────────────>│          │           │                 │
│  │     (C12)      │                    │          ▼           │                 │
│  └────────────────┘                    │  ┌────────────────┐  │                 │
│                                        │  │ mmio_controller│  │                 │
│  ┌────────────────┐                    │  └───────┬────────┘  │                 │
│  │   Switch[0]    │───switch_0────────>│          │           │                 │
│  │     (J15)      │                    └──────────┼───────────┘                 │
│  └────────────────┘                               │                              │
│                                    ┌──────────────┼──────────────┐              │
│                                    ▼              ▼              ▼              │
│                          ┌──────────────┐ ┌──────────────┐ ┌──────────────┐     │
│                          │ VGA Display  │ │  7-Segment   │ │  LED[15:0]   │     │
│                          │  (A3~D8)     │ │ (T10~U13)    │ │  (H17~R12)   │     │
│                          │ 640×480@60Hz │ │    8자리      │ │  Heartbeat   │     │
│                          │ "ODD"/"EVEN" │ │  입력 숫자    │ │  + 결과      │     │
│                          └──────────────┘ └──────────────┘ └──────────────┘     │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
</pre>
    </div>
    <p class="caption">[그림 1-2] 시스템 블록도</p>

    <h3>1.3.4 개발 환경</h3>

    <table>
        <tr>
            <th>항목</th>
            <th>사양</th>
        </tr>
        <tr>
            <td>Target Board</td>
            <td>Nexys A7-100T (Xilinx Artix-7 XC7A100T)</td>
        </tr>
        <tr>
            <td>System Clock</td>
            <td>100 MHz</td>
        </tr>
        <tr>
            <td>Development Tool</td>
            <td>Vivado 2020.2</td>
        </tr>
        <tr>
            <td>HDL</td>
            <td>Verilog</td>
        </tr>
        <tr>
            <td>C Compiler</td>
            <td>riscv32-unknown-elf-gcc</td>
        </tr>
    </table>
    <p class="caption">[표 1-5] 개발 환경</p>

</body>

</html>