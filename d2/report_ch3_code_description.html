<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>3. 코딩 - RISC-V Pipeline Processor</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 11pt;
            line-height: 1.8;
            max-width: 210mm;
            margin: 0 auto;
            padding: 20mm;
        }

        h1 {
            font-size: 18pt;
            margin: 30px 0 20px;
            border-bottom: 2px solid #000;
            padding-bottom: 10px;
        }

        h2 {
            font-size: 14pt;
            margin: 25px 0 15px;
        }

        h3 {
            font-size: 12pt;
            margin: 20px 0 10px;
        }

        p {
            margin: 10px 0;
            text-align: justify;
            text-indent: 1em;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 9pt;
        }

        th,
        td {
            border: 1px solid #000;
            padding: 6px;
            text-align: center;
        }

        th {
            background: #f0f0f0;
        }

        td.left {
            text-align: left;
        }

        .caption {
            text-align: center;
            font-size: 10pt;
            margin: 10px 0;
            font-weight: bold;
        }

        .diagram {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 20px;
            margin: 20px 0;
        }

        .diagram pre {
            font-size: 8pt;
            line-height: 1.2;
            margin: 0;
        }

        pre {
            background: #f5f5f5;
            padding: 15px;
            font-size: 9pt;
            line-height: 1.4;
            overflow-x: auto;
            border: 1px solid #ddd;
        }

        code {
            background: #f0f0f0;
            padding: 2px 5px;
            font-family: Consolas, monospace;
            font-size: 10pt;
        }

        ul,
        ol {
            margin: 15px 0 15px 30px;
        }

        li {
            margin: 8px 0;
        }

        .page-num {
            text-align: center;
            font-size: 10pt;
            margin: 30px 0;
            color: #666;
        }

        @media print {
            .page-break {
                page-break-before: always;
            }
        }
    </style>
</head>

<body>

    <div class="page-num">- 14 -</div>

    <h1>3. 코딩</h1>

    <h2>3.1 모듈 계층도</h2>

    <div class="diagram">
        <pre>
top.v (Top Module)
│
├── data_path.v (CPU Core) ───────────────────────────────────────────────────────
│   │
│   ├── blk_mem_gen_0 (Vivado BRAM IP) ─── 8KB Dual-Port RAM
│   │
│   ├── pipeline_registers.v ──────────── IF/ID, ID/EX, EX/MEM, MEM/WB 레지스터
│   │
│   ├── mmio_controller.v ─────────────── MMIO Read/Write 처리
│   │
│   ├── pc_logic.v ────────────────────── PC 계산, 분기 처리
│   │
│   ├── control_unit.v ────────────────── Opcode → Control Signals
│   │
│   ├── prv32_ALU.v (ALU.v) ───────────── 산술/논리 연산
│   │   └── shifter.v ─────────────────── Shift 연산 (SLL, SRL, SRA)
│   │
│   ├── RegFile (reger.v) ─────────────── 32 × 32-bit Register File
│   │   ├── register.v (32_reg.v) ─────── 32-bit Register
│   │   │   └── reg.v ─────────────────── D Flip-Flop
│   │   └── multiplexer.v ─────────────── 2:1 MUX
│   │
│   ├── imm_gen.v ─────────────────────── Immediate Generator
│   │
│   ├── ALU_op.v ──────────────────────── ALU Control Unit
│   │
│   ├── branch.v ──────────────────────── Branch Comparator
│   │
│   ├── Forward_Unit.v ────────────────── Data Forwarding Logic
│   │
│   ├── Hazard_Unit_prediction.v ──────── Stall Detection
│   │
│   └── ripple.v ──────────────────────── Adder (PC+4, PC+Imm)
│
├── ps2_kbd_top.v (PS2 Keyboard) ─────────────────────────────────────────────────
│   ├── ps2_kbd_new.v ─────────────────── Scancode Decoder
│   └── ps2_debounce_pulse.v ──────────── Debounce & Pulse
│
├── number_input_buffer.v ────────────── 숫자 입력 버퍼 (BCD 변환 포함)
│
├── vga_controller.v ─────────────────── VGA Timing (640×480@60Hz)
│
├── vga_text_display.v ───────────────── ODD/EVEN 텍스트 렌더링
│
└── seven_segment_8_driver.v ─────────── 8-digit 7-Segment Driver
</pre>
    </div>
    <p class="caption">[그림 3-1] 모듈 계층도</p>

    <div class="page-break"></div>
    <div class="page-num">- 15 -</div>

    <h2>3.2 오픈소스/AI 사용 여부</h2>

    <p>
        양식에 따라 각 모듈별 오픈소스 및 생성형 AI 사용 여부를 아래 표에 정리하였다.
    </p>

    <table>
        <tr>
            <th>모듈명</th>
            <th>기능</th>
            <th>파일명</th>
            <th>수업 배포<br>코드</th>
            <th>오픈소스<br>사용</th>
            <th>AI 도움 여부<br>및 내용</th>
        </tr>
        <tr>
            <td class="left">top</td>
            <td class="left">최상위 모듈</td>
            <td>top.v</td>
            <td>X</td>
            <td>X</td>
            <td class="left">O (Claude) - 모듈 연결 로직</td>
        </tr>
        <tr>
            <td class="left">data_path</td>
            <td class="left">CPU 파이프라인</td>
            <td>data_path.v</td>
            <td>X</td>
            <td>O (darkriscv, 구조 참조 후 수정)</td>
            <td class="left">O (Claude) - MMIO 통합</td>
        </tr>
        <tr>
            <td class="left">pipeline_registers</td>
            <td class="left">파이프라인 레지스터</td>
            <td>pipeline_registers.v</td>
            <td>X</td>
            <td>X</td>
            <td class="left">O (Claude) - 모듈 분리</td>
        </tr>
        <tr>
            <td class="left">mmio_controller</td>
            <td class="left">MMIO 처리</td>
            <td>mmio_controller.v</td>
            <td>X</td>
            <td>X</td>
            <td class="left">O (Claude) - 주소 디코딩</td>
        </tr>
        <tr>
            <td class="left">pc_logic</td>
            <td class="left">PC 계산</td>
            <td>pc_logic.v</td>
            <td>X</td>
            <td>X</td>
            <td class="left">O (Claude) - 모듈 분리</td>
        </tr>
        <tr>
            <td class="left">control_unit</td>
            <td class="left">제어 신호 생성</td>
            <td>control_unit.v</td>
            <td>X</td>
            <td>O (darkriscv, 수정)</td>
            <td class="left">-</td>
        </tr>
        <tr>
            <td class="left">prv32_ALU</td>
            <td class="left">ALU</td>
            <td>ALU.v</td>
            <td>O (수정)</td>
            <td>X</td>
            <td class="left">-</td>
        </tr>
        <tr>
            <td class="left">RegFile</td>
            <td class="left">레지스터 파일</td>
            <td>reger.v</td>
            <td>O (수정없음)</td>
            <td>X</td>
            <td class="left">-</td>
        </tr>
        <tr>
            <td class="left">imm_gen</td>
            <td class="left">즉시값 생성</td>
            <td>imm_gen.v</td>
            <td>O (수정없음)</td>
            <td>X</td>
            <td class="left">-</td>
        </tr>
        <tr>
            <td class="left">Forward_Unit</td>
            <td class="left">포워딩</td>
            <td>Forward_Unit.v</td>
            <td>O (수정없음)</td>
            <td>X</td>
            <td class="left">-</td>
        </tr>
        <tr>
            <td class="left">Hazard_Unit</td>
            <td class="left">해저드 감지</td>
            <td>Hazard_Unit_prediction.v</td>
            <td>O (수정없음)</td>
            <td>X</td>
            <td class="left">-</td>
        </tr>
        <tr>
            <td class="left">ps2_kbd_top</td>
            <td class="left">PS2 키보드</td>
            <td>ps2_kbd_top.v</td>
            <td>O (Lab11 제공, 수정)</td>
            <td>X</td>
            <td class="left">-</td>
        </tr>
        <tr>
            <td class="left">ps2_kbd_new</td>
            <td class="left">스캔코드 디코딩</td>
            <td>ps2_kbd_new.v</td>
            <td>O (Lab11 제공, 수정없음)</td>
            <td>X</td>
            <td class="left">-</td>
        </tr>
        <tr>
            <td class="left">number_input_buffer</td>
            <td class="left">숫자 입력 버퍼</td>
            <td>number_input_buffer.v</td>
            <td>X</td>
            <td>X</td>
            <td class="left">O (Claude) - BCD 변환</td>
        </tr>
        <tr>
            <td class="left">vga_controller</td>
            <td class="left">VGA 타이밍</td>
            <td>vga_controller.v</td>
            <td>X</td>
            <td>X</td>
            <td class="left">O (Claude) - 생성</td>
        </tr>
        <tr>
            <td class="left">vga_text_display</td>
            <td class="left">ODD/EVEN 표시</td>
            <td>vga_text_display.v</td>
            <td>X</td>
            <td>X</td>
            <td class="left">O (Claude) - 비트맵 폰트</td>
        </tr>
        <tr>
            <td class="left">seven_segment_8_driver</td>
            <td class="left">7-Segment 드라이버</td>
            <td>seven_segment_8_driver.v</td>
            <td>O (수정없음)</td>
            <td>X</td>
            <td class="left">-</td>
        </tr>
    </table>
    <p class="caption">[표 3-1] 모듈별 오픈소스/AI 사용 여부</p>

    <div class="page-break"></div>
    <div class="page-num">- 16 -</div>

    <h3>3.2.1 오픈소스 수정 내역</h3>

    <h4>(1) darkriscv (GitHub)</h4>
    <ul>
        <li><strong>원본:</strong> https://github.com/darklife/darkriscv</li>
        <li><strong>수정 사항:</strong>
            <ul>
                <li>메모리 인터페이스를 Vivado BRAM IP(blk_mem_gen_0)에 맞게 수정</li>
                <li>MMIO 영역 추가 (PS2, VGA, LED, Number Buffer)</li>
                <li>파이프라인 레지스터를 별도 모듈로 분리</li>
            </ul>
        </li>
        <li><strong>수정 이유:</strong> Nexys A7 보드 및 I/O 장치와 호환되도록 인터페이스 변경</li>
    </ul>

    <h4>(2) 수업 배포 코드 (Lab11 - PS2)</h4>
    <ul>
        <li><strong>사용 파일:</strong> ps2_kbd_new.v, ps2_debounce_pulse.v</li>
        <li><strong>수정 사항:</strong> ps2_kbd_top.v의 포트 신호명 일부 수정</li>
    </ul>

    <h3>3.2.2 AI 활용 내역</h3>

    <p>
        본 프로젝트에서는 Claude AI를 활용하여 다음과 같은 작업을 수행하였다:
    </p>

    <table>
        <tr>
            <th>작업</th>
            <th>AI 역할</th>
            <th>수정/검토</th>
        </tr>
        <tr>
            <td class="left">MMIO Controller 설계</td>
            <td class="left">주소 디코딩 로직 초안 생성</td>
            <td class="left">PS2, VGA 주소 직접 추가</td>
        </tr>
        <tr>
            <td class="left">VGA Text Display</td>
            <td class="left">비트맵 폰트 패턴 생성</td>
            <td class="left">글자 크기 및 위치 조정</td>
        </tr>
        <tr>
            <td class="left">Number Input Buffer</td>
            <td class="left">Double Dabble 알고리즘</td>
            <td class="left">최대값 제한 로직 추가</td>
        </tr>
        <tr>
            <td class="left">모듈 리팩토링</td>
            <td class="left">data_path.v 모듈 분리 제안</td>
            <td class="left">신호 연결 검증</td>
        </tr>
        <tr>
            <td class="left">보고서 작성</td>
            <td class="left">HTML 보고서 양식 생성</td>
            <td class="left">내용 검토 및 수정</td>
        </tr>
    </table>
    <p class="caption">[표 3-2] AI 활용 내역</p>

    <div class="page-break"></div>
    <div class="page-num">- 17 -</div>

    <h2>3.3 주요 모듈 IO 기능 설명</h2>

    <h3>3.3.1 data_path.v</h3>

    <table>
        <tr>
            <th>포트</th>
            <th>방향</th>
            <th>너비</th>
            <th>설명</th>
        </tr>
        <tr>
            <td>clk, rst</td>
            <td>Input</td>
            <td>1, 1</td>
            <td>시스템 클럭, 리셋</td>
        </tr>
        <tr>
            <td>ps2_scancode_in</td>
            <td>Input</td>
            <td>8</td>
            <td>PS2 스캔코드</td>
        </tr>
        <tr>
            <td>ps2_key_pressed_in</td>
            <td>Input</td>
            <td>1</td>
            <td>키 눌림 신호</td>
        </tr>
        <tr>
            <td>num_buffer_in</td>
            <td>Input</td>
            <td>32</td>
            <td>입력된 숫자</td>
        </tr>
        <tr>
            <td>num_valid_in</td>
            <td>Input</td>
            <td>1</td>
            <td>Enter 눌림 플래그</td>
        </tr>
        <tr>
            <td>led_reg_out</td>
            <td>Output</td>
            <td>16</td>
            <td>LED 제어</td>
        </tr>
        <tr>
            <td>vga_result_out</td>
            <td>Output</td>
            <td>2</td>
            <td>VGA 결과 (0/1/2)</td>
        </tr>
        <tr>
            <td>inst_out_ext</td>
            <td>Output</td>
            <td>32</td>
            <td>현재 명령어 (디버그)</td>
        </tr>
        <tr>
            <td>PC_ext</td>
            <td>Output</td>
            <td>32</td>
            <td>현재 PC (디버그)</td>
        </tr>
    </table>
    <p class="caption">[표 3-3] data_path.v 주요 포트</p>

    <h3>3.3.2 mmio_controller.v</h3>

    <table>
        <tr>
            <th>포트</th>
            <th>방향</th>
            <th>설명</th>
        </tr>
        <tr>
            <td>mem_write, addr, write_data</td>
            <td>Input</td>
            <td>SW 명령어 정보</td>
        </tr>
        <tr>
            <td>bram_data</td>
            <td>Input</td>
            <td>BRAM에서 읽은 데이터</td>
        </tr>
        <tr>
            <td>ps2_scancode, ps2_key_pressed</td>
            <td>Input</td>
            <td>PS2 키보드 입력</td>
        </tr>
        <tr>
            <td>num_buffer, num_valid</td>
            <td>Input</td>
            <td>Number Buffer 입력</td>
        </tr>
        <tr>
            <td>data_out</td>
            <td>Output</td>
            <td>LW 명령어 결과</td>
        </tr>
        <tr>
            <td>led_reg</td>
            <td>Output</td>
            <td>LED 제어 레지스터</td>
        </tr>
        <tr>
            <td>vga_result</td>
            <td>Output</td>
            <td>VGA 결과 레지스터</td>
        </tr>
        <tr>
            <td>is_bram_write</td>
            <td>Output</td>
            <td>BRAM 쓰기 활성화</td>
        </tr>
    </table>
    <p class="caption">[표 3-4] mmio_controller.v 포트</p>

</body>

</html>